//- Base
extends ../basePagesTMP

//- Mixins
mixin tourHeroBoxDetails(text, icon)
  div(class="heading-box__detail")
    svg(class="heading-box__icon")
      use(xlink:href=`./img/icons.svg#icon-${icon}`)
    span(class="heading-box__text")= text

//- Fact item
mixin overviewBoxDetail(icon, label, date)
  div(class="overview-box__detail")
    svg(class="overview-box__icon")
      use(xlink:href=`./img/icons.svg#icon-${icon}`)
    span(class="overview-box__label")= label
    span(class="overview-box__text")= date

//- User reviews 
mixin userReviewCard(review)
  div(class="reviews__card")
    div(class="reviews__avatar")
      img(src=`./img/users/${review.user.photo}`, alt=`${review.user.name} photograph`, class="reviews__avatar-img")
      h6(class="reviews__user")= review.user.name

    p(class="reviews__text")= review.review

    div(class="reviews__rating" data-rating=`${review.rating}`)
      - let stars = [1, 2, 3, 4, 5]
      each star in stars
        svg(class=`reviews__star ${review.rating >= star ? 'reviews__star--active' : ''}`)
            use(xlink:href="./img/icons.svg#icon-star")

//- Content
block content 
  //- Header section
  section.section-header
    .header__hero
      .header__hero-overlay &nbsp;
      img.header__hero-img(src=`/img/tours/${tour.imageCover}`, alt=`${tour.name} photo`)

    .heading-box
      h1.heading-primary
        span= tour.name
      div(class="heading-box__group")
        +tourHeroBoxDetails(`${tour.duration} days`, 'clock')
        +tourHeroBoxDetails(tour.startLocation.description, 'map-pin')

  //- Quick Facts Section
  section.section-description
    div.overview-box
      div
        div(class="overview-box__group")
          h2.heading-secondary.ma-bt-lg Quick facts

          //- Prep date
          - const nextDate = tour.startDates.find(date =>  new Date(date).getTime() > Date.now() )
          - const startDate = new Date(nextDate).toLocaleString('en-US', { month: 'short', year: 'numeric' })

          +overviewBoxDetail('calendar', 'Next date', startDate)
          +overviewBoxDetail('trending-up', 'Difficulty', tour.difficulty)
          +overviewBoxDetail('user', 'Participants', `${tour.maxGroupSize}  people`)
          +overviewBoxDetail('star', 'rating', `${tour.ratingsAverage} / 5`)

        div(class="overview-box__group")
          h2.heading-secondary.ma-bt-lg Your tour guides
          //- Each tour guide
          each guide in tour.guides
            div(class="overview-box__detail")
              img(src=`./img/users/${guide.photo}`, alt="Lead guide photo", class="overview-box__img")

              - if(guide.role === 'lead-guide')
                span(class="overview-box__label") Lead guide

              - if(guide.role === 'guide')
                span(class="overview-box__label") Tour guide

              span(class="overview-box__text")= guide.name

    div.description-box
      h2.heading-secondary.ma-bt-lg About the park camper tour

      - const paragraphs = tour.description.split('\n')
      each p in paragraphs
        p(class="description__text")= p

  //- Images/gallery display section
  section.section-pictures
    each img,idx in tour.images
      div.picture-box
        img(class=`picture-box__img picture-box__img--${idx}`, src=`./img/tours/${img}`, alt=`${tour.name} image gallery ${idx}`)

  //- Tours map Section
  section.section-map
    -const locations = JSON.stringify(tour.locations)
    div#map(data-location=`${locations}`)

  //- User reviews section
  section.section-reviews
    div.reviews
      each review in tour.reviews
        +userReviewCard(review)

  //- CTA Section
  section.section-cta
    div.cta
      div(class="cta__img cta__img--logo")
        img(src="./img/logo-white.png", alt="Natours logo")
      img(src=`./img/tours/${tour.images[0]}`, alt=`${tour.name} cta image`, class="cta__img cta__img--1")
      img(src=`./img/tours/${tour.images[1]}`, alt=`${tour.name} cta image`, class="cta__img cta__img--2")

      div(class="cta__content")
        h2.heading-secondary What are you waiting for?
        p(class="cta__text")= `${tour.duration} days. 1 adventure. Infinite memories. Make it yours today!`
        //- login status
        if user
          button.btn.btn--green.span-all-rows Book tour now!
        else 
          a.btn.btn--warning.span-all-rows(href="/sys-admin/login") Login to book now!