{"version":3,"file":"login.js","sources":["../modules/login.js"],"sourcesContent":["import { asyncErrorWrapper, errorWrapper } from '../utils/handleErrors.js';\r\nimport httpRequestHelper, {\r\n  handleHttpErrors,\r\n} from '../utils/httpRequestsHelper.js';\r\nimport redirectTo from '../utils/redirectsHelper.js';\r\n\r\n/**\r\n * Handles user login\r\n * @todo Add CSRF protection\r\n *\r\n * @param {String} formEl form DOM element\r\n */\r\nconst handleLogin = async function (formEl) {\r\n  return asyncErrorWrapper(async () => {\r\n    // Handle form submit\r\n    // Form inputs\r\n    const formData = new FormData(formEl);\r\n    const email = formData.get('email');\r\n    const password = formData.get('password');\r\n\r\n    // Check if they are available before submiting\r\n    if (!email || !password) throw new Error('Email or Password missing');\r\n\r\n    // Submit data for processing\r\n    const submitUrl = '/api/v1/users/login';\r\n    const submitData = {\r\n      email,\r\n      password,\r\n    };\r\n\r\n    const response = await httpRequestHelper(submitUrl, {\r\n      submitData,\r\n      dataType: 'normal',\r\n      requestMethod: 'POST',\r\n      sendPlainResponse: true,\r\n    });\r\n\r\n    /// Handle failed request\r\n    if (!response.ok) {\r\n      throw new Error('Login failed ðŸ˜¢ðŸ˜¢ðŸ˜¢');\r\n    }\r\n\r\n    /// Handle errors from the server\r\n    await handleHttpErrors(response, 'Login failed ðŸ˜¢ðŸ˜¢ðŸ˜¢');\r\n\r\n    /// Successful login -> Message handled by the server to survive redirect\r\n    // Redirect to /sys-admin\r\n    // TODO: Redirect /sys-admin\r\n    redirectTo('/sys-admin', {\r\n      redirectOption: 'disallowGoBack',\r\n      allowDelay: true,\r\n    });\r\n  });\r\n};\r\n\r\nexport default handleLogin;\r\n"],"names":[],"mappings":";;AAYK,MAAC,cAAc,eAAgB,QAAQ;AAC1C,SAAO,kBAAkB,YAAY;AAGnC,UAAM,WAAW,IAAI,SAAS,MAAM;AACpC,UAAM,QAAQ,SAAS,IAAI,OAAO;AAClC,UAAM,WAAW,SAAS,IAAI,UAAU;AAGxC,QAAI,CAAC,SAAS,CAAC;AAAU,YAAM,IAAI,MAAM,2BAA2B;AAGpE,UAAM,YAAY;AAClB,UAAM,aAAa;AAAA,MACjB;AAAA,MACA;AAAA,IACN;AAEI,UAAM,WAAW,MAAM,kBAAkB,WAAW;AAAA,MAClD;AAAA,MACA,UAAU;AAAA,MACV,eAAe;AAAA,MACf,mBAAmB;AAAA,IACzB,CAAK;AAGD,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,0CAAqB;AAAA,IACtC;AAGD,UAAM,iBAAiB,UAAU,0CAAqB;AAKtD,eAAW,cAAc;AAAA,MACvB,gBAAgB;AAAA,MAChB,YAAY;AAAA,IAClB,CAAK;AAAA,EACL,CAAG;AACH;;"}